<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ItemEdit</title>
    <!-- CSS dependencies -->
    <link rel="stylesheet" href="/static/css/all.css" type="text/css" />
    <link
      href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!--<link rel="stylesheet" href="/static/css/wireframe.css"> -->
    <!--====== Slick css ======-->
    <link rel="stylesheet" href="/static/css/slick.css" />
    <!--====== Line Icons css ======-->
    <link rel="stylesheet" href="/static/css/LineIcons.css" />
    <!--====== Style css ======-->
    <link rel="stylesheet" href="/static/css/nav-style.css" />
    <link rel="stylesheet" href="/static/scss/theme.css" />
    <!--修改用户头像图片预览-->
    <style type="text/css">
      /*       #preview {
        float: left;
        border: none;
      }

      #preview img {
        margin-right: 10px;
        width: 150px;
        height: 150px;
      } */
      #show_img {
        display: flex;
        margin: 0;
        padding: 0;
        height: 100%;
      }

      #show_img li {
        margin: 0;
        padding: 0;
        margin-left: 20px;
        max-height: 100%;
      }

      #show_img li:first-child {
        margin: 0;
      }
    </style>
  </head>

  <body>
    <div
      class="text-dark bg-secondary"
      style="position: relative; overflow: hidden;"
    >
      <img
        class="img-fluid"
        src="https://qiju-1252919816.cos.ap-chongqing.myqcloud.com/static/gif/dog.gif"
        style=" background-repeat:no-repeat;width:100%"
      />
      <div style="background-color: #feea96;">
        <div class="row">
          <div class="col-md-12">
            <div class="row" style="text-align:center;">
              <div class="order-md-1 col-md-8" style="left:18%">
                <h4 class="mb-2 text-center"><b>Edit your item here.</b></h4>
                <form class="needs-validation" id="reg-form">
                  <div class="mb-1 form-group has-feedback text-left">
                    <label for="used_time" class="text-left">几成新</label>
                    <div class="input-group">
                      <!-- <div class="input-group-prepend"> <span class="input-group-text">@</span> </div>-->
                      <input
                        type="text"
                        class="form-control"
                        id="used_time"
                        placeholder="如：全新/使用2年"
                        required
                      />
                    </div>
                  </div>
                  <div class="mb-1 text-left">
                    <label for="type">物品类别</label>
                    <select
                      class="custom-select d-block w-100"
                      id="type"
                      required="required"
                    >
                      <option value="not_choose">Choose...</option>
                      <option value="book">书</option>
                      <option value="electric">电子用品</option>
                      <option value="furniture">家具</option>
                      <option value="sporting">运动器材</option>
                      <option value="vehicle">交通工具</option>
                      <option value="other">其他</option>
                    </select>
                  </div>
                  <div class="mb-1 text-left">
                    <label for="description">物品描述</label>
                    <input
                      type="text"
                      class="form-control"
                      id="description"
                      placeholder="如：品牌、使用方法等"
                    />
                  </div>
                  <div class="row">
                    <div class="col-md-6 form-group has-feedback">
                      <div class="form-group text-left">
                        <label for="price">价格</label>
                        <input
                          type="text"
                          class="form-control"
                          placeholder="定价"
                          id="price"
                          required=""
                        />
                      </div>
                    </div>
                    <div class="col-md-6 form-group has-feedback">
                      <div class="form-group text-left">
                        <label for="price_discuss">价格是否可议</label>
                        <select
                          class="custom-select d-block w-100"
                          id="price_discuss"
                          required="required"
                        >
                          <option value="not_choose">Choose...</option>
                          <option value="1">可议</option>
                          <option value="0">不可议</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-lg-3 col-md-4">
                      <!--上传按钮-->
                      <div class="row ml-1">
                        <label for="itemimage">上传闲置物品图片</label>
                        <div
                          style="z-index:1;float: left;min-width:9.2rem;width:auto;"
                          id="upload"
                        >
                          <img
                            class="img-fluid d-block d-inline-flex"
                            src="https://qiju-1252919816.cos.ap-chongqing.myqcloud.com/static/img/plus.jpg"
                            width="180"
                          />
                        </div>
                        <div style="position:absolute;z-index:2;float: left;">
                          <input
                            type="file"
                            style=" opacity: 0;filter: alpha(opacity=0);
                                      width:11rem;height: 10rem;cursor: pointer;"
                            accept="image/*"
                            id="house_image"
                          />
                          <input id="house_image_url" type="hidden" />
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-9 col-md-8 pt-4">
                      <div
                        class="tab-content"
                        id="v-pills-tabContent"
                        style="height: 100%"
                      >
                        <div
                          style="height: 100%"
                          class="tab-pane fade show active"
                          id="v-pills-furniture"
                          role="tabpanel"
                          aria-labelledby="v-pills-furniture-tab"
                        >
                          <div class="product-items mt-30" style="height: 100%">
                            <ul id="show_img">
                              <li>
                                <img />
                              </li>
                            </ul>
                            <!-- row -->
                          </div>
                          <!-- product items -->
                        </div>
                        <!-- tab pane -->
                      </div>
                    </div>
                  </div>
                  <!-- row -->
                  <!--上传闲置物品图片-->
                  <div class="buttons">
                    <input
                      style="margin-top: 30px"
                      value="提 交 编 辑"
                      type="buuton"
                      class="btn btn-lg btn-block btn-primary"
                      id="save_item_info"
                    />
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12 text-center pt-4">
            <p class="mb-1">© 2018-2019 发际线保卫队</p>
            <ul class="list-inline">
              <li class="list-inline-item text-white">
                <a href="#" class="text-dark">Privacy</a>
              </li>
              <li class="list-inline-item">
                <a href="#" class="text-dark">Terms</a>
              </li>
              <li class="list-inline-item">
                <a href="#" class="text-dark">Support</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <script src="https://g.alicdn.com/mui/jquery/4.0.1/jquery.js"></script>
    <!--<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" ></script>-->
    <!--====== Slick js ======-->
    <script src="/static/js/slick.min.js"></script>
    <!--====== nav js ======-->
    <script src="/static/js/jquery.nav.js"></script>
    <!--====== Main js ======-->
    <script src="/static/js/main.js"></script>
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" ></script>-->
    <script src="https://cdn.staticfile.org/axios/0.18.0/axios.min.js"></script>
    <script>
      var item_image = '';
      // 编辑/更新物品信息
      if (/^#\/page\/([a-zA-Z0-9_-]{8,})$/.test(location.hash)) {
        var match = location.hash.match(/^#\/page\/([a-zA-Z0-9_-]{8,})$/);
        var item_id = match[1];
        axios.get('/qiju/item/profile?item_id=' + item_id).then(resp => {
          if (resp.data.code === 1) {
            var data = resp.data.data;
            console.log(data);
            $('#used_time').val(data.used_time);
            $('#type').val(data.type);
            $('#description').val(data.description);
            // $('#region').val(data.region);
            $('#price').val(data.price);
            $('#price_discuss').val(data.price_discuss);
            item_image = data.item_image;
            $('#show_img').html(
              `<li><img src="${
                item_image
              }" style="max-height:100%; width: auto;" /></li>`
            );
          }
        });
        // 更新闲置物品信息
        $('#save_item_info').click(function(e) {
          axios
            .post('/qiju/item/itemUpdate', {
              item_id: item_id,
              description: $('#description').val(),
              used_time: $('#used_time').val(),
              price: $('#price').val(),
              price_discuss: $('#price_discuss option:selected').val(),
              item_image: item_image,
              type: $('#type option:selected').val()
            })
            .then(function(response) {
              console.log(response);
              if (response.data.code === 1) {
                location.href = '../user/user_page.html'; //路由定位到我发布的闲置物品模块
              } else {
                alert('发布失败了，请稍后再试');
              }
            })
            .catch(function(error) {
              console.log(error);
            });
          e.preventDefault();
          return false;
        });
      } else {
        // 新建一个闲置物品
        $('#save_item_info').click(function(e) {
          axios
            .post('/qiju/user/itemEdit', {
              description: $('#description').val(),
              used_time: $('#used_time').val(),
              price: $('#price').val(),
              price_discuss: $('#price_discuss option:selected').val(),
              item_image: item_image,
              type: $('#type option:selected').val()
            })
            .then(function(response) {
              console.log(response);
              if (response.data.code === 1) {
                location.href = '../user/user_page.html'; //路由定位到我发布的闲置物品模块
              } else {
                alert('发布失败了，请稍后再试');
              }
            })
            .catch(function(error) {
              console.log(error);
            });
          e.preventDefault();
          return false;
        });
      }

      //上传房屋图像
      $('#house_image').change(function(event) {
        // console.log(event)
        // 不支持HTML5 FileReader
        var file = event.target.files[0];
        var param = new FormData(); // 创建form对象
        param.append('file', file, file.name); // 通过append向form对象添加数据
        console.log(param.get('file')); // FormData私有类对象，访问不到，可以通过get判断值是否传进去
        var config = {
          headers: {
            'Content-Type': 'multipart/form-data'
          }
        };
        // 添加请求头
        axios.post('/qiju/file/upload', param, config).then(response => {
          console.log(response.data);
          if (response.data.url) {
            item_image = response.data.url;
            $('#show_img').html(
              `<li><img src="${
                response.data.url
              }" style="max-height:100%; width: auto;" /></li>`
            );
          }
        });
      });
    </script>
  </body>
</html>
