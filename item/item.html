<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- PAGE settings -->
  <!-- <link rel="icon" href="https://templates.pingendo.com/assets/Pingendo_favicon.ico"> -->
  <title>闲置物品</title>
  <!-- CSS dependencies -->
  <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/5.8.2/css/fontawesome.min.css" type="text/css">    
  <link rel="stylesheet" href="/static/css/wireframe.css">
  <link rel="stylesheet" href="/static/css/all.css" type="text/css">
  <link rel="stylesheet" href="/static/scss/theme.css">
  <link href="/static/css/Home.css" rel="stylesheet" type="text/css">
  <style>
      a:link{text-decoration:none;}
    @font-face{
      font-family:qiju;
        src:url('https://qiju-1252919816.cos.ap-chongqing.myqcloud.com/static/fonts/CYHLSFT.ttf');
    }

    a.knowmore {

      text-transform: uppercase;
      letter-spacing: 0.07rem;
      color: white !important;
      height: 35px;
      width: 50px;
      display: block;
      overflow: hidden;

      background-repeat: no-repeat;

      transition: all 0.3s;
      line-height: 20px;
    }

    a.knowmore:link {
      text-decoration: none;
    }

    a.knowmore:hover,
    a.knowmore:focus {
      color: black !important;
      padding: 5px 5px 5px 5px;
      background-color: #FFF;

      text-decoration: none !important;
      box-shadow: inset 0 0 0 0 #CCC;
      transition: all 0.3s;
    }
  </style>
</head>

<body style="background-image: url('https://qiju-1252919816.cos.ap-chongqing.myqcloud.com/static/img/floor-tile.png');">
  <div id="app">

    <div class="in collapse" style="background-image: url(https://qiju-1252919816.cos.ap-chongqing.myqcloud.com/static/img/dynamic-style.png);" id="navbarHeader">
      <div class="container">
        <div class="row" >
          <div class="py-4 col-md-3 navig">
            <a href="../user/login.html" class="text-decoration-none" id="switchLoginOrLogout">
              <h2>登录</h2>
              <h5>点这里~</h5>
            </a>
          </div>
          <div class="py-4 col-md-3 navig" id="userCenter">
            <a href="../user/user_page.html" class="text-decoration-none">
              <h2>个人中心</h2>
              <h5>请先登录哦</h5>
            </a>
          </div>
          <div class="py-4 col-md-3 navig">
            <a href="xianzhi.html" class="text-decoration-none">
              <h2>闲置物品</h2>
              <h5>便捷处理闲置物品</h5>
            </a>
          </div>
          <div class="col-md-3 navig py-4">
            <h2>关于我们</h2>
            <ul class="list-unstyled">
              <li class="shadow-none">
                <a href="#" class="text-decoration-none">官方微博</a>
              </li>
              <li class="">
                <a href="#" class="text-decoration-none">官方微信</a>
              </li>
              <li class="">
                <a href="#" class="text-decoration-none">官方邮箱</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="navbar">
      <div class="container d-flex justify-content-between">
        <a href="../index.html" class="navbar-brand d-flex align-items-center"> <i class="d-block far fa-lg fa-building text-body"></i>
          <h1 style="font-family:qiju;" class="pb-0 mb-0">栖居</h1>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarHeader" aria-expanded="true">
          <img url="" src="https://qiju-1252919816.cos.ap-chongqing.myqcloud.com/static/gif/364.gif" width="50"> </button>
      </div>
    </div>
    <div class="container">
      <div class="row">
        <div class="col-md-12 col-lg-12 mt-1">
          <div class="card text-center">
            <!--<div class="card-header">-->
            <!--  <ul class="nav nav-tabs card-header-tabs">-->
            <!-- 导航头部 -->
            <ul class="nav nav-bar pt-2" style="background-color:#eee;">
              <li class="nav-item navigator">
                <router-link class="nav-link active show" to="/page/book">
                  <h4 class="px-2">&nbsp;书&nbsp;</h4>
                </router-link>
              </li>
              <li class="nav-item navigator">
                <router-link class="nav-link" to="/page/electric">
                  <h4>电子用品</h4>
                </router-link>
              </li>
              <li class="nav-item navigator">
                <router-link class="nav-link" to="/page/furniture">
                  <h4 class="px-1">家具</h4>
                </router-link>
              </li>
              <li class="nav-item navigator">
                <router-link class="nav-link" to="/page/sporting">
                  <h4>运动器材</h4>
                </router-link>
              </li>
              <li class="nav-item navigator">
                <router-link class="nav-link" to="/page/vehicle">
                  <h4>交通工具</h4>
                </router-link>
              </li>
              <li class="nav-item navigator">
                <router-link class="nav-link" to="/page/other">
                  <h4>其他</h4>
                </router-link>
              </li>
            </ul>
            <!--</div>-->
            <div class="card-body">
              <div class="tab-content mt-2">
                <!-- 路由出口 -->
                <!-- 路由匹配到的组件将渲染在这里 -->
                <router-view :items="items"></router-view>
              </div>
              <!-- 翻页组件 -->
              <div class="container">
                <div class="row">
                  <div class="col-md-12">
                    <ul class="pagination pt-5" style="margin-left:41.5%;">
                      <li class="page-item"> <a class="page-link" href="#"> <span>«</span></a> </li>
                      <!--  -->
                      <!--  -->
                      <!-- 当点击Page时，更新Page data -->
                      <!--  -->
                      <!--  -->
                      <li class="page-item active"> <a class="page-link" href="#">1</a> </li>
                      <li class="page-item"> <a class="page-link" href="#">2</a> </li>
                      <li class="page-item"> <a class="page-link" href="#">3</a> </li>
                      <li class="page-item"> <a class="page-link" href="#">4</a> </li>
                      <li class="page-item"> <a class="page-link" href="#"> <span>»</span></a> </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="container" style="margin-top:80px">
        <div class="row">
          <div class="col-md-12 text-center"><a>
              <p class="mb-1 h6 text-muted">© 2018-2019 发际线保卫队</p>
            </a>
            <ul class="list-inline text-muted"><a>
              </a>
              <li class="list-inline-item text-white"><a>
                </a><a href="#" class="text-info h6">Privacy</a>
              </li>
              <li class="list-inline-item">
                <a href="#" class="text-info h6">Terms</a>
              </li>
              <li class="list-inline-item">
                <a href="#" class="text-info h6">Support</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <footer class="text-muted">
        <!-------点击“详情”弹出的弹框-------->
        <div class="modal fade" id="item1" style="display: none;" aria-hidden="true">
          <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
              <div class="modal-header bg-light">
                <h4 class="modal-title ml-2"> 物品详情</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span
                    aria-hidden="true">×</span> </button>
              </div>
              <div class="modal-body bg-light w-100 ">
                <div class="row">
                  <div class="col-md-12">
                    <div class="carousel slide mx-2" data-ride="carousel" id="carousel">
                      <div class="carousel-inner">
                        <div class="carousel-item active">
                          <img :src="modalRenderData.item_image" class="d-block img-fluid w-100" >
                        </div>
                      </div> <a class="carousel-control-prev" href="#carousel" role="button" data-slide="prev"> <span
                          class="carousel-control-prev-icon"></span> <span class="sr-only">Previous</span> </a> <a
                        class="carousel-control-next" href="#carousel" role="button" data-slide="next"> <span
                          class="carousel-control-next-icon"></span> <span class="sr-only">Next</span> </a>
                    </div>
                  </div>
                </div>
                <div class="container ">
                  <div class="row">
                    <div class="col-md-12 col-lg-12 mt-1">
                      <div class="card text-center">
                        <div class="card-header">
                          <ul class="nav nav-tabs card-header-tabs">
                            <li class="nav-item">
                              <a class="nav-link active show" data-toggle="tab" data-target="#tabone" href="#">详情</a>
                            </li>
                            <li class="nav-item">
                              <a class="nav-link" data-toggle="tab" data-target="#tabthree" href="#">联系方式</a>
                            </li>
                            <li class="nav-item">
                              <a class="btn btn-primary px-3 " onclick="toCollectHouse(this)" href="#"><i
                                  class="far fa-star fa-fw fa-1x py-1"></i></a>
                            </li>
                          </ul>
                        </div>
                        <div class="card-body ">
                          <div class="tab-content mt-2">
                            <div class="tab-pane fade active show" id="tabone" role="tabpanel">
                              <div class="col-md-12 bg-light b">
                                <div class="row">
                                  <div class="col-md-4 border-bottom mt-0">
                                    <h5 class="pt-2">详细信息</h5>
                                  </div>
                                  <div class="col-md-8 border-bottom mt-0">
                                    <h5 class="pt-2 text-left" v-text="modalRenderData.description">自行车，奇狮24寸通勤车，功能完好</h5>
                                  </div>
                                </div>
                                <div class="row">
                                  <div class="col-md-4 border-bottom mt-0">
                                    <h5 class="pt-2">价格</h5>
                                  </div>
                                  <div class="col-md-2 border-bottom mt-0">
                                    <h5 class="pt-2 text-left">{{ modalRenderData.price }}/元</h5>
                                  </div>
                                  <div class="col-md-6 border-bottom mt-0">
                                    <h5 class="pt-2 text-left">{{ modalRenderData.price_discuss ? '' : '不' }}可砍价</h5>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div class="tab-pane fade" id="tabthree" role="tabpanel">
                              <div class="col-md-12 bg-light">
                                <div class="row">
                                  <div class="col-md-1 border-bottom mt-0">
                                    <h5 class="pt-2">QQ</h5>
                                  </div>
                                  <div class="col-md-3 border-bottom mt-0">
                                    <h5 class="pt-2 text-center">123456789</h5>
                                  </div>
                                  <div class="col-md-1 border-bottom mt-0">
                                    <h5 class="pt-2">微信</h5>
                                  </div>
                                  <div class="col-md-3 border-bottom mt-0">
                                    <h5 class="pt-2 text-center">netmug</h5>
                                  </div>
                                  <div class="col-md-1 border-bottom mt-0">
                                    <h5 class="pt-2">手机号</h5>
                                  </div>
                                  <div class="col-md-3 border-bottom mt-0">
                                    <h5 class="pt-2 text-center">12345678912</h5>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-------点击“详情”弹出的弹框-------->
        <!-------未登录弹出的弹框-------->
       <div class="modal fade text-muted" style="display: none;" aria-hidden="true" id="failCollect">
          <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
              <div class="modal-header bg-light">
                <h4 class="modal-title py-2 ml-2"><b>请先登陆再进行此操作: )</b></h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span
                    aria-hidden="true">×</span> </button>
              </div>
            </div>
          </div>
        </div>
         <!-------未登录弹出的弹框-------->
        <!-------已经登出弹出的弹框-------->
        <div class="modal fade white" style="display: none;" aria-hidden="true" id="LogoutSuccess">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header bg-light">
                  <h4 class="modal-title py-2 ml-2"><b>成功登出: )</b></h4>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">×</span> </button>
                </div>
              </div>
            </div>
          </div>
          <!-------已经登出弹出的弹框-------->
      </footer>
    </div>
  </div>
  <script src="https://cdn.staticfile.org/axios/0.18.0/axios.min.js"></script>
  <script src="https://g.alicdn.com/mui/jquery/4.0.1/jquery.js"></script>
  <script src="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script src="https://cdn.bootcss.com/popper.js/1.15.0/umd/popper.min.js"></script>
  <script src="https://cdn.staticfile.org/vue/2.6.10/vue.js"></script>
  <script src="https://cdn.bootcss.com/vue-router/3.0.6/vue-router.min.js"></script>
  <script id="tab_show" type="text/html">
    <div class="tab-pane fade  active show" :id="$route.params.category" role="tabpanel">
        <div class="col-md-12 bg-light b">
          <div class="container">
            <div class="row">
              <template v-for="(item, index) in items">
                  <div class="col-md-4 p-3">
                      <div class="card box-shadow">
                        <a  @click="showAndRender(index)" data-toggle="modal" data-target="#item1">
                          <img class="card-img-top" :src="item.item_image" height="250px">
                        </a>
                        <div class="card-body pt-1 pb-1 px-1 border-top">
                          <h5 class="text-left" v-text="item.description"></h5>
                          <i class="fa fa-jpy d-inline" aria-hidden="true">
                            <span v-text="item.price"></span>
                            <span>（{{ item.price_discuss ? '' : '不' }}可议价）</span>
                          </i>
                          <div class="row">
                            <div class="col-md-6 mt-2 mb-0 pl-3 pr-4">
                              <a @click="showAndRender(index)" class="btn btn-primary knowmore px-1" data-toggle="modal" data-target="#item1">
                                <p style="margin-top:1px;">详情</p>
                              </a></div>
                            <div class="col-md-6 my-2"><a class="btn btn-primary knowmore ml-5 mr-2" onclick="toCollectItem(this)"><i class="collect far fa-star fa-fw fa-1x" style="margin-top:4px;"></i></a></div>
                          </div>
                        </div>
                      </div>
                  </div>
              </template>
            </div>
          </div>
        </div>
      </div>
  </script>
  <script>
    var Tab_show = {
      props: [ 'items' ],
      template: document.getElementById('tab_show').innerHTML,
      methods: {
        showAndRender(index) {
          this.$parent.renderIndex = index;
        }
      }
    }

    var app = new Vue({
      el: '#app',
      created: function () {
        // 数据第一次初始化拉取
        this.fetchData();
      },
      router: new VueRouter({
        routes: [
          { path: '/page/:category', component: Tab_show },
        ]
      }),
      computed: {
        // 分类 与路由绑定
        category: function () {
          return this.$route.params.category;
        },
        modalRenderData: function () {
          if (this.items.length > this.renderIndex) {
            return this.items[this.renderIndex];
          }
          return {
            description: '绿色自行车奇狮24寸通勤车',
            price: '0.00',
            price_discuss: 0,
            item_image: 'https://qiju-1252919816.cos.ap-chongqing.myqcloud.com/static/img/book.png'
          };
        }
      },
      methods: {
        // 拉取数据
        fetchData() {
          axios
            .get('/qiju/item/getAll', {
              params: {
                page: this.page,
                category: this.category,
              }
            })
            .then(({ data }) => {
              if (data.code === 1) {
                data = data.data;
                // 调用vue以更新视图
                this.items = data.list;
              }
            })
            .catch((reason) => {
              console.log(reason);
            })
        }
      },
      watch: {
        // 当分类/Page变化时，刷新数据
        category: function (val) {
          // 数取更新拉取
          this.fetchData();
        },
        page: function (val) {
          // 数取更新拉取
          this.fetchData();
        }
      },
      // 视图需要的数据
      data: {
        renderIndex: 0,
        page: 1,
        // items: [],
        items: [
          {
            description: '自行车奇狮24寸通勤车，功能完好，成色如图，带锁',
            price: '22.80',
            price_discuss: 0,
            item_image: 'https://qiju-1252919816.cos.ap-chongqing.myqcloud.com/static/img/book.png'
          },
          {
            description: '自行车奇狮24寸通勤车，功能完好，成色如图，带锁',
            price: '11.90',
            price_discuss: 1,
            item_image: 'https://qiju-1252919816.cos.ap-chongqing.myqcloud.com/static/img/chair.png'
          },
          {
            description: '自行车奇狮24寸通勤车，功能完好，成色如图，带锁',
            price: '13.60',
            price_discuss: 0,
            item_image: 'https://qiju-1252919816.cos.ap-chongqing.myqcloud.com/static/img/chair.png'
          },
          {
            description: '自行车奇狮24寸通勤车，功能完好，成色如图，带锁',
            price: '5.90',
            price_discuss: 0,
            item_image: 'https://qiju-1252919816.cos.ap-chongqing.myqcloud.com/static/img/chair.png'
          },
          {
            description: '自行车奇狮24寸通勤车，功能完好，成色如图，带锁',
            price: '1.98',
            price_discuss: 1,
            item_image: 'https://qiju-1252919816.cos.ap-chongqing.myqcloud.com/static/img/book.png'
          },
          {
            description: '自行车奇狮24寸通勤车，功能完好，成色如图，带锁',
            price: '119.68',
            price_discuss: 0,
            item_image: 'https://qiju-1252919816.cos.ap-chongqing.myqcloud.com/static/img/book.png'
          },
        ]
      }
    });

    // 本页面建议移除jQuery依赖
  </script>
  <script type="text/javascript">
  //登录登出切换
  axios.get('/qiju/user/online').then(function(res) {
      if (res.data.code === 1) {
        var online = res.data.data.online;
        var nav = $('.navig');
          if (online) {
          var switchLoginOrLogout = $('#switchLoginOrLogout');
          switchLoginOrLogout.attr('href', '');
          switchLoginOrLogout.find('h2').html('登出');
          switchLoginOrLogout.click(function () {
            axios.get('/qiju/user/logout').then(resp => {
              if (resp.data.code === 1) {
                // 提示已登出
                alter("登出成功");
                $("#LogoutSuccess").modal('show');
               // setTimeout(function () {
                //$("#LogoutSuccess").modal('hide');
                //}, 1000);
                setTimeout(() => {
                  window.location.reload();
                }, 500);
                //隐藏个人中心
                  nav.removeClass('col-md-3').addClass('col-md-4');
                  $('#userCenter').hide();
              }
            })
          })
        }else{
          //显示个人中心
          nav.removeClass('col-md-4').addClass('col-md-3');
          $('#userCenter').show();
          }
        } else {
          alert("Ooh,失败了,请稍后再试");
        }
      }).catch(function(error) {
        console.log(error);
      });
    /*var oLis=document.getElementsByTagName("li");*/
    var oLis = $(".navigator");
    oLis.click(function() {
      $(this).siblings().removeClass('clickstyle');
      $(this).addClass('clickstyle');
    });
    //-----------------------闲置物品收藏js----------------------//
    function toCollectItem(ele) {
      axios.post('/qiju/user/collectItem', {
        item_id: ele.dataset.id,
      }).then(function (response) {
        console.log(response);
        // 未登录
        if (response.data.code === -1 && response.data.message === '需要验证') {
          //若用户未登录，不允许进行收藏操作，但允许浏览。跳转至登录界面
           //alert("Ooh,请先登录再操作哦");
           $("#failCollect").modal('show');
          //$("#failCollect").show(); //failCollect对应弹框无效操作提醒弹框的id
          setTimeout(function () {
            $("#failCollect").modal('hide');
            location.href = '../user/login.html';
          }, 1500);
        
          return;
        }
        // 已登录
        // 切换收藏状态
        if (response.data.code === 1) {
          var thisHouseCollect = $(ele).find("i");
          if (thisHouseCollect.hasClass('far')) {
            thisHouseCollect.removeClass('far').addClass('fas')
          } else {
            thisHouseCollect.removeClass('fas').addClass('far');
          }
        }
      }).catch(function (error) {
        console.log(error);
      });
    };
  </script>
</body>

</html>
