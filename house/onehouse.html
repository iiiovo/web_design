<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.8.2/css/fontawesome.min.css" type="text/css" />
  <link rel="stylesheet" href="/static/css/all.css" type="text/css" />
  <link rel="stylesheet" href="/static/scss/theme.css" />
  <style>
    [hidden] {
      visibility: hidden;
    }

    [v-cloak] {
      display: none;
    }

    .hidden {
      display: none !important;
    }

    @font-face {
      font-family: qiju;
      src: url('https://qiju-1252919816.cos.ap-chongqing.myqcloud.com/static/fonts/CYHLSFT.ttf');
    }

    #cat div {
      display: none;
    }

    #cat:hover div {
      display: initial;
    }

    #painted-eggshell {
      display: flex;
      width: 100%;
      padding: 0;
      margin: 0;
      justify-content: center;
      align-items: center;
      height: 260px;
      text-align: center;
      font-size: 1.8rem;
    }

    .cn-row {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
    }
  </style>
</head>

<body
  style="background-image: url(https://qiju-1252919816.cos.ap-chongqing.myqcloud.com/static/img/dynamic-style.png);">
  <div id="app">
    <div class="in collapse" id="navbarHeader"
      style='background-image: url("https://qiju-1252919816.cos.ap-chongqing.myqcloud.com/static/img/dynamic-style.png");'>
      <div class="container">
        <div class="row">
          <div class="py-4 col-md-3 navigator">
            <a id="switchLoginOrLogout" href="/user/login.html" class="text-decoration-none">
              <h2>登录</h2>
              <h5>点这里~</h5>
            </a>
          </div>
          <div class="py-4 col-md-3 navigator" id="userCenter" hidden>
            <a href="../user/user_page.html" class="text-decoration-none">
              <h2>个人中心</h2>
              <h5>请先登录哦</h5>
            </a>
          </div>
          <div class="py-4 col-md-3 navigator">
            <a href="../item/xianzhi.html" class="text-decoration-none">
              <h2>闲置物品</h2>
              <h5>便捷处理闲置物品</h5>
            </a>
          </div>
          <div class="col-md-3 navigator py-4">
            <h2>关于我们</h2>
            <ul class="list-unstyled">
              <li class="shadow-none">
                <a href="javascript:;" class="text-decoration-none">官方微博</a>
              </li>
              <li class="">
                <a href="javascript:;" class="text-decoration-none">官方微信</a>
              </li>
              <li class="">
                <a href="javascript:;" class="text-decoration-none">官方邮箱</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="navbar">
      <div class="container d-flex justify-content-between">
        <a href="../index.html" class="navbar-brand d-flex align-items-center">
          <i class="d-block far fa-lg fa-building text-body"></i>
          <h1 style="font-family:qiju;" class="pb-0 mb-0">栖居</h1>
        </a>
        <button id="cat" class="navbar-toggler collapsed" type="button" data-toggle="collapse"
          data-target="#navbarHeader" aria-expanded="false">
          <img url="" src="https://qiju-1252919816.cos.ap-chongqing.myqcloud.com/static/gif/364.gif" width="50" />
          <div style="position:relative;float:left;z-index:10;font-family:qiju;font-size: 22px;border-radius: 50%;"
            class="text-black bg-light p-2">
            "迷路啦？点我点我~~~"<div>
        </button>
      </div>
    </div>
    <div :class="house_rent_status === -1 ? 'hidden' : ''" class="cn-row">
      <div class="col-md-6 px-0">
        <div class="carousel slide" data-ride="carousel" id="carousel">
          <div class="carousel-inner">
            <template v-for="(one_image, index) in house_image">
              <div class="carousel-item" :class="switchGenClass(index)">
                <img class="d-block" :src="one_image" style="height: 520px;width: 100%" />
              </div>
            </template>
            <!-- <div class="carousel-item active carousel-item-left">
              <img
                class="d-block"
                src="https://qiju-1252919816.cos.ap-chongqing.myqcloud.com/static/img/living-room-1.jpg"
                height="520px"
              />
            </div>
            <div class="carousel-item carousel-item-next carousel-item-left">
              <img
                class="d-block"
                src="https://qiju-1252919816.cos.ap-chongqing.myqcloud.com/static/img/preview16.jpg"
                height="520px"
              />
            </div>
            <div class="carousel-item">
              <img
                class="d-block w-100"
                src="https://qiju-1252919816.cos.ap-chongqing.myqcloud.com/static/img/living-room-11.jpg"
                height="520px"
              />
            </div> -->
          </div>
          <a class="carousel-control-prev" href="#carousel" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#carousel" role="button" data-slide="next">
            <span class="carousel-control-next-icon"></span>
            <span class="sr-only">Next</span>
          </a>
        </div>
      </div>
      <div class="col-md-3 bg-light b">
        <div class="row">
          <div class="col-md-12 border-bottom mt-0">
            <h2 class="pt-2" contenteditable="true">详细信息</h2>
          </div>
          <div class="col-md-4 border-bottom">
            <h5 class="pt-2">租金</h5>
          </div>
          <div class="col-md-8 border-bottom ">
            <p v-cloak class="pt-2">{{ price }}/月</p>
          </div>
          <div class="col-md-4 border-bottom">
            <h5 class="pt-2">养宠物</h5>
          </div>
          <div class="col-md-8 border-bottom">
            <p v-cloak class="text-left pt-2">{{ pet ? '' : '不' }}可以</p>
          </div>
          <div class="col-md-4  border-bottom">
            <h5 class="pt-2">地区</h5>
          </div>
          <div class="col-md-8 border-bottom">
            <p class="text-left pt-2" v-text="region">荣昌</p>
          </div>
          <div class="col-md-4 px-2 pt-2 border-bottom">
            <h5>详细的地址</h5>
          </div>
          <div class="col-md-8 border-bottom">
            <p class="pt-2 text-left" v-text="address">
              重庆市荣昌区学院路158号，启昌财富广场
            </p>
          </div>
          <div class="col-md-4 px-2 pt-2 border-bottom">
            <h5>房中设备</h5>
          </div>
          <div class="col-md-8 border-bottom">
            <p class="pt-2 text-left" v-text="facility">
              洗衣机，热水器，空调，衣柜，无线，独卫
            </p>
          </div>
          <div class="col-md-4 px-2 border-bottom">
            <h5 class="pt-2">联系方式</h5>
          </div>
          <div class="col-md-8 border-bottom">
            <p class="pt-2 text-left" v-cloak>QQ: {{ qq || '无' }}</p>
            <p v-cloak>wechat: {{ wechat || '无' }}</p>
            <p v-cloak>手机号：{{ phone || '无' }}</p>
          </div>
        </div>
      </div>
    </div>
    <div class="container">

      <div id="eggshell" class="row">
        <div class="container h-50">
          <div class="row">
            <div class="col-md-12 col-lg-12 mt-1">
              <div class="card text-center">
                <div class="card-header pb-1">
                  <ul class="nav nav-tabs card-header-tabs">
                    <li class="nav-item">
                      <a class="nav-link active" data-toggle="tab" data-target="#tabthree">
                        <h3 class="mb-0">房源评价</h3>
                      </a>
                    </li>
                    <li class="nav-item ">
                      <a class="btn btn-primary px-3" @click="toCollectHouse">
                        <i :class="house_collect_status ? 'fas' : 'far'"
                          class="collect fa-star fa-fw fa-1x py-1"></i></a>
                    </li>
                  </ul>
                </div>
                <div class="card-body pb-4">
                  <div class="tab-content">
                    <div class="tab-pane fade active show" id="tabthree" role="tabpanel">
                      <div class="row mb-3 ">
                        <div class="col-md-8">
                          <input v-model="remark_content" style="margin-left:18%;height:100px;" type="text"
                            name="pinlun" maxlength="200" class="border border-dark w-100 form-control-lg"
                            placeholder="登录后才能评价哦~" />
                        </div>

                        <div class="col-md-4">
                          <div style="margin-top:53px">
                            <a class="btn btn-primary isclick px-2 pb-0 pt-0 ml-0" href="javascript:;">
                              <h4 @click="makeOneRemark" class="mt-1 mb-1">
                                发表评论
                              </h4>
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div v-for="remark in remarkList" class="row mt-4 border-bottom border-top">
                      <div class="col-md-4 mt-3">
                        <h5 v-cloak class="pt-2">{{ remark.user_name || remark.user_id }}：</h5>
                      </div>
                      <div class="col-md-8 mt-3">
                        <p v-text="remark.remark_content" class="pt-2 text-left" style="white-space:pre;"></p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="container" style="margin-top: 120px;">
          <div class="row">
            <div class="col-md-12 text-center">
              <a>
                <p class="mb-1 h6 text-muted">© 2018-2019 发际线保卫队</p>
              </a>
              <ul class="list-inline text-muted">
                <a> </a>
                <li class="list-inline-item text-white">
                  <a> </a><a href="javascript:;" class="text-info h6">Privacy</a>
                </li>
                <li class="list-inline-item">
                  <a href="javascript:;" class="text-info h6">Terms</a>
                </li>
                <li class="list-inline-item">
                  <a href="javascript:;" class="text-info h6">Support</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdn.staticfile.org/axios/0.18.0/axios.min.js"></script>
  <script src="https://g.alicdn.com/mui/jquery/4.0.1/jquery.js"></script>
  <script src="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script src="https://cdn.bootcss.com/popper.js/1.15.0/umd/popper.min.js"></script>
  <script src="https://cdn.staticfile.org/vue/2.6.10/vue.js"></script>
  <script src="/static/js/hashRouter.min.js"></script>
  <script>
    var HOUSE_ID = '';
    var app = new Vue({
      el: '#app',
      data: {
        house_id: '',
        region: '',
        address: '',
        price: '',
        pet: 1,
        price_discuss: -1,
        facility: '',
        house_image: [],
        house_rent_status: -1,
        create_time: '',
        update_time: '',
        qq: '',
        wechat: '',
        phone: '',
        house_collect_status: 0,
        // 要提交的评论
        remark_content: '',
        // 拉取的评论列表
        remarkList: [
          {
            user_name: '系统消息',
            remark_content:
              '这里还没有评论哟，快来发表评论吧 o(*￣▽￣*)ブ'
          }
        ]
      },
      methods: {
        switchGenClass(index) {
          index++;
          if (index === 1) {
            return 'active';
          }
          if (index === 2) {
            return 'carousel-item-next';
          }
          return '';
        },
        toCollectHouse() {
          axios
            .post('/qiju/user/collectHouse', {
              house_id: this.house_id
            })
            .then(response => {
              console.log(response);
              if (response.data.code === 1) {
                this.house_collect_status = !this.house_collect_status + 0;
              }
            })
            .catch(function (error) {
              console.log(error);
            });
        },
        makeOneRemark() {
          var remark_content = '' + this.remark_content;
          axios
            .post('/qiju/house/remarkCreate', {
              house_id: this.house_id,
              remark_content
            })
            .then(response => {
              console.log(response);
              this.remark_content = '';
              if (response.data.code === 1) {
                this.remarkList.unshift({
                  user_name: '我',
                  remark_content
                });
              }
            })
            .catch(function (error) {
              console.log(error);
            });
        }
      },
      watch: {
        house_id: function (val) {
          if (val) {
            axios
              .get('/qiju/house/access?house_id=' + val)
              .then(({ data }) => {
                if (data.code === 1) {
                  data = data.data;
                  Object.keys(data).forEach(k => {
                    if (Reflect.has(this, k)) {
                      this[k] = data[k];
                    }
                  });
                }
              });
            axios
              .get('/qiju/house/remarks?house_id=' + val)
              .then(({ data }) => {
                if (data.code === 1) {
                  data = data.data;
                  console.log(data);
                  this.remarkList = data.list;
                }
              });
          }
        }
      }
    });
    qRouter.init();
    qRouter.on('/page/:house_id', function (req) {
      app.house_id = HOUSE_ID = req.params.house_id;
    });

    // 建议移除 jq
    //登录登出切换
    axios
      .get('/qiju/user/online')
      .then(function (res) {
        if (res.data.code === 1) {
          // var online = res.data.data.online;
          var nav = $('.navigator');
          // if (online) {
          var switchLoginOrLogout = $('#switchLoginOrLogout');
          switchLoginOrLogout.removeAttr('href');
          switchLoginOrLogout.css({ cursor: 'pointer' });
          switchLoginOrLogout.find('h2').html('登出');
          switchLoginOrLogout.click(function () {
            axios.get('/qiju/user/logout').then(resp => {
              if (resp.data.code === 1) {
                // 提示已登出
                // alter("登出成功");.
                //  online ? '' : 'data-toggle="modal" data-target="#LogoutSuccess"';
                setTimeout(() => {
                  window.location.reload();
                }, 210);
                // //隐藏个人中心
                //   nav.removeClass('col-md-3').addClass('col-md-4');
                //   $('#userCenter').hide();
              }
            });
          });
          $('#userCenter').removeAttr('hidden');
        } else {
          $('#eggshell').prepend(`
            <div id="painted-eggshell">
              恭喜你喜提彩蛋~ b(￣▽￣)d<br>您似乎是直接链接进入本页面的，请先登录哟
            </div>`);
        }
      })
      .catch(function (error) {
        console.log(error);
      });
  </script>
</body>

</html>